%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Adapted to English and filled with thesis content
% for the University of Trieste theme by Isac Pasianotto.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass{beamer}

% Load all required packages for the theme
\usepackage{otherResources/presentazione_allPackages}
\usetikzlibrary{shapes.geometric, positioning}
\usetikzlibrary{shapes.arrows, positioning}
\usetikzlibrary{positioning,calc,arrows.meta,fit,backgrounds,matrix}

% Document metadata
\hypersetup{
	pdfauthor={Nicola Perin},
	pdftitle={Designing and deploying a FAIR-by-design data pipeline and platform for electron microscopy laboratories},
	pdfsubject={Research thesis in: Data Management}
}

% Title block
\title[FAIR-by-design EM pipeline]{Designing and deploying a FAIR-by-design data pipeline and platform for electron microscopy laboratories}
\subtitle{Research thesis in: Data Management}
\institute{University of Trieste}
\author[Nicola Perin]{Nicola Perin}
\year=2025
\month=09
\day=19

% Advisors & labels (translated to English)
\def\relatore{Dott. Federica Bazzocchi}
\def\relatoreLabel{Supervisor}
% \def\correlatore{<Co-supervisor name>}
% \def\correlatoreLabel{Co-supervisor}
\def\candidatoLabel{Candidate}

% Logos (use your local paths if different)
\def\LogoUniversita{otherResources/Units.Logo3Righe.png}
\def\LogoDipartimento{otherResources/DSSC_logo.png}
\def\LogoFiligrana{otherResources/background-blu.png}

% Apply theme customizations
\input{otherResources/presentazione_myThemeSetting.tex}

% ---- Slides ----
\begin{document}
	
	% =====================
	% Title & Agenda
	% =====================
	
	% Title frame (special dissertation style from the theme)
	\begin{frame}
		\setTitlestyleDissertation
		\maketitle
	\end{frame}
	
	% Agenda
	\begin{frame}
		\frametitle{Outline}
	\end{frame}
	
	% =====================
	% Story: Intro → FAIR → Case Study → Design → VirtualOrfeo → App Walkthrough
	% =====================
	
	% --- 1) Intro: EM, data, issues, needs ---
	
	\begin{frame}
		\frametitle{Electron microscopy at a glance}
		\begin{itemize}
			\item Different modes: TEM, SEM, STEM → images, diffraction patterns, spectra.
			\item The data: large, complex, and very diverse in shape and size.
			\item The reality: every vendor has their own format, metadata is often incomplete.
		\end{itemize}
		\vspace{0.5em}
		\small\textit{The key question: how do we make these outputs easier to reuse and share?}
	\end{frame}
	
	\begin{frame}
		\frametitle{Current Problems and What’s Needed}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.58\textwidth}
			\begin{itemize}
				\item \textbf{Fragmentation}: many formats, weak or missing metadata.
				\item \textbf{Friction}: manual copying, endless zip files, confusing naming.
				\item \textbf{Collaboration}: unclear provenance, scattered access, hard to reuse.
				\item \textbf{Need}: structured metadata, persistent IDs, scalable storage, simple tools.
			\end{itemize}
			\column{0.42\textwidth}
			%\includegraphics[width=\textwidth]{img/diagrams/data_fragments_placeholder.png}% optional
		\end{columns}
	\end{frame}
	
	% --- FAIR + NeXus (rewritten) ---
	\begin{frame}
		\frametitle{A way forward: FAIR and NeXus (NXem)}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.55\textwidth}
			\begin{itemize}
				\item FAIR principles: \textbf{findable, accessible, interoperable, reusable}.
				\item \textbf{HDF5}: efficient format for large, structured datasets.
				\item \textbf{NeXus}: conventions for scientific data (\texttt{NXinstrument}, \texttt{NXsample}).
				\item \textbf{NXem}: application definition tailored to electron microscopy.
			\end{itemize}
			\column{0.45\textwidth}
			\includegraphics[width=\textwidth]{otherResources/FAIR_data_principles.png}
			\includegraphics[width=\textwidth]{otherResources/HDF5_diagram.png}
			\includegraphics[width=\textwidth]{otherResources/NEXUS_logo.png}
		\end{columns}
		\vspace{0.5em}
		\small At the national level, these FAIR practices are promoted and supported by the NFFA-DI infrastructure.
	\end{frame}
	
	% --- NFFA-DI introduction (new slide) ---
	\begin{frame}
		\frametitle{Introducing NFFA-DI}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.55\textwidth}
			\begin{itemize}
				\item \textbf{NFFA-DI} = Nano Foundries and Fine Analysis – Digital Infrastructure.
				\item Italian research initiative connecting major nanoscience centers.
				\item Goal: open access to advanced instrumentation, FAIR data, and computational resources.
				\item Acts as the national driver for FAIR data practices in nanoscience.
			\end{itemize}
			\column{0.5\textwidth}
			\includegraphics[width=\textwidth]{otherResources/NFFA_map.png} % replace with your map image
			\vspace{2em}
			\tiny Source: \url{https://nffa-di.it/en/}
		\end{columns}
	\end{frame}
	
	% --- 2) Case study: LAME @ Area Science Park, ORFEO storage, current gap ---
	\begin{frame}
		\frametitle{From the lab to the datacenter}
		
		\begin{columns}[T,totalwidth=\textwidth]
			% Left column: text
			\column{0.55\textwidth}
			\begin{itemize}
				\item \textbf{LAME} produces multi-terabyte datasets in electron microscopy.
				\item As part of NFFA-DI, its work depends on sharing data with other partners.
				\item To support this, \textbf{ORFEO} provides the backbone: HPC resources, 
				identity services, and S3-compatible object storage.
				\item The challenge: connecting LAME’s lab workflows with ORFEO’s infrastructure.
			\end{itemize}
			
			% Right column: stacked images + arrow
			\column{0.45\textwidth}
			\centering
			\begin{tikzpicture}[node distance=1.0cm]
				% microscope node
				\node (microscope) at (0,0.5) {\includegraphics[width=0.5\textwidth]{otherResources/LAME_microscope.png}};
				% orfeo node placed below with manual shift
				\node (orfeo) at (0,-3.0) {\includegraphics[width=0.5\textwidth]{otherResources/ORFEO.png}};
				% arrow
				\draw[->, line width=1.5mm, blue!60!black] ([yshift=+5mm]microscope.south) -- (orfeo.north);
			\end{tikzpicture}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{ORFEO’s storage model}
		\framesubtitle{Objects, not files}
		
		ORFEO does not use a classic file-and-folder hierarchy.  
		Instead, data is stored as \textbf{objects} inside \textbf{buckets}, managed by Ceph RGW with the S3 protocol.  
		Each object combines the raw data with flexible metadata, which makes it easier to describe and reuse datasets.
		
		\centering
		\includegraphics[width=0.7\textwidth]{otherResources/CEPH_RGW_diagram.png} % replace with your diagram
	\end{frame}
		
	\begin{frame}
		\frametitle{Accessing ORFEO}
		\framesubtitle{One front door for all services}
		
		All access to ORFEO’s resources goes through a single \textbf{Ingress} endpoint.  
		Connections are secured with \textbf{TLS certificates}, and identity is handled by  
		\textbf{FreeIPA} and \textbf{Authentik}, providing single sign-on across services.
		
		\vspace{1em}
		\centering
		\includegraphics[width=0.8\textwidth]{otherResources/authentik_login.png} % placeholder diagram
	\end{frame}
	
	\begin{frame}
		\frametitle{From problems to a proposal}
		
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.48\textwidth}
			\textbf{What’s missing for LAME}
			\begin{itemize}
				\item Data often stuck on lab machines or portable drives.
				\item Transfers are manual, with inconsistent folder structures.
				\item No ingestion standard → hard to reuse or integrate with ORFEO/NFFA-DI.
			\end{itemize}
			
			\column{0.48\textwidth}
			\textbf{Our proposal}
			\begin{itemize}
				\item \textbf{Transfer}: move data directly into ORFEO using the S3 protocol.
				\item \textbf{Transform}: convert outputs (e.g.\ TIFF) into NeXus/NXem with standardized metadata.
				\item \textbf{Integrate}: build on ORFEO’s existing services, with a simple web interface and API.
			\end{itemize}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Choosing a framework}
		
		To put our proposal into practice, we need a tool that researchers can actually use.  
		That means building a \textbf{web application} that can:
		
		\vspace{1em}
		\begin{itemize}
			\item guide researchers through projects, samples, and experiments,
			\item handle uploads and metadata in a consistent way,
			\item connect directly to ORFEO’s services (S3 storage, authentication).
		\end{itemize}
		
		Once this was clear, the next step was to choose the right framework.
	\end{frame}
	
	\begin{frame}
		\frametitle{Why Django?}
		
		We needed a framework that was stable, flexible, and easy to maintain.  
		Django fits well because it provides:
		
		\vspace{1em}
		\begin{itemize}
			\item A structured way to model projects, samples, and experiments.
			\item Built-in tools to create both a user interface and an API.
			\item Support for background tasks such as data checks and conversions.
			\item Strong support for authentication and long-term maintenance.
		\end{itemize}
	\end{frame}
	
	\begin{frame}
		\frametitle{Thinking about the whole pipeline}
		
		\centering
		\resizebox{\textwidth}{!}{%
			\begin{tikzpicture}[thick]
				
				% geometry
				\def\h{3.0}   % much taller
				\def\w{3.0}   % body width before the tip
				\def\t{1.0}   % tip / notch depth
				
				% one chevron at x-offset #1, with title #2, subtitle #3, and fill color #4
				\newcommand{\chevron}[4]{%
					\begin{scope}[shift={(#1,0)}]
						\path[draw=black, fill=#4, line join=round]
						(0,0) -- (\w,0) -- (\w+\t,0.5*\h) -- (\w,\h) -- (0,\h) -- (\t,0.5*\h) -- cycle;
						% two lines: bold title + smaller subtitle
						\node[align=center, xshift=7mm] at (\w/2,0.5*\h) {\textbf{#2} \\[0.3em] \scriptsize #3};
					\end{scope}
				}
				
				% chain of tall chevrons
				\chevron{0*\w}{Application}{Django webapp}{green!35}
				\chevron{1*\w}{Identity}{Auth, users}{teal!40}
				\chevron{2*\w}{Ingress}{TLS front door}{cyan!40}
				\chevron{3*\w}{Storage}{Ceph S3 buckets}{blue!30}
				\chevron{4*\w}{Compute}{HPC jobs}{blue!45}
				
			\end{tikzpicture}%
		}
		
		\vspace{1em}
		\small The app is one part of this chain — testing only makes sense when the whole path is reproduced.  
		Our solution: a \textbf{digital twin} of ORFEO.
	\end{frame}
	
	% --- 4) VirtualOrfeo ---
	\begin{frame}
		\frametitle{VirtualOrfeo}
		
		ORFEO is a complex infrastructure: identity, ingress, storage, and compute.  
		Testing our Django app directly on production would be risky and slow.
		
		\vspace{1em}
		\begin{itemize}
			\item \textbf{VirtualOrfeo} is a lightweight clone of ORFEO, built on K3s.
			\item It uses the same Helm charts and configs as production.
			\item This lets us deploy the \textbf{Django app} in a realistic environment:
			it can authenticate through Authentik, upload to S3 buckets,
			and be accessed through the same ingress as in ORFEO.
		\end{itemize}
	\end{frame}
	
	\begin{frame}
		\frametitle{VirtualOrfeo topology}
		\includegraphics[width=\textwidth]{otherResources/VirtualOrfeo_topology.png}
	\end{frame}
	
	% --- 5) App walkthrough ---
	
	\begin{frame}
		\frametitle{How the App is Structured}
		\begin{itemize}
			\item Domain: Project → Proposal → Sample → Experiment → Measurements.
			\item Data plane: browser ↔ S3 using presigned URLs; metadata in Postgres.
			\item Workers: checksum, metadata extraction, NeXus builds.
		\end{itemize}
		%\includegraphics[width=\textwidth]{img/diagrams/app_architecture_placeholder.png
	\end{frame}
	
	\begin{frame}
		\frametitle{Logging In}
		\framesubtitle{Identity before data}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.52\textwidth}
			\begin{itemize}
				\item Auth handled by Authentik (OIDC).
				\item Django sees tokens, not passwords.
				\item Group claims set roles; disabling an account works instantly.
			\end{itemize}
			\column{0.48\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/login_authentik.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Managing Research Data}
		\framesubtitle{Projects, Samples, Experiments}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.52\textwidth}
			\begin{itemize}
				\item Three-pane board to create and link entities.
				\item Context stored next to raw data (\texttt{README.txt}).
				\item Same functionality via REST API for automation.
			\end{itemize}
			\column{0.48\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/board_overview.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Uploading Data}
		\framesubtitle{Presigned S3 PUT}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.55\textwidth}
			\begin{itemize}
				\item App gives a one-time URL, browser streams directly to storage.
				\item Handles large files without overloading the web server.
				\item Uploads automatically trigger checksum and registration jobs.
			\end{itemize}
			\column{0.45\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/upload_form.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{From TIFF to NeXus}
		\framesubtitle{Metadata extraction and mapping}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.52\textwidth}
			\begin{itemize}
				\item Extract metadata from TIFF headers or JSON blocks.
				\item Normalize values and map into NXem fields.
				\item Build \texttt{.nxs} files with a standard structure.
			\end{itemize}
			\column{0.48\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/nexus_preview.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Background Jobs}
		\framesubtitle{Let workers handle the heavy tasks}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.52\textwidth}
			\begin{itemize}
				\item RQ queues for checksums and NeXus builds.
				\item Jobs are idempotent, retry automatically if needed.
				\item Monitoring via web UI and structured logs.
			\end{itemize}
			\column{0.48\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/rq_dashboard.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Browsing and Sharing}
		\framesubtitle{Buckets and downloads}
		\begin{columns}[T,totalwidth=\textwidth]
			\column{0.55\textwidth}
			\begin{itemize}
				\item Browse buckets, download with presigned links.
				\item On-the-fly ZIPs for folders; \texttt{aria2} manifests for bulk.
				\item Derived data stored in a mirrored namespace.
			\end{itemize}
			\column{0.45\textwidth}
			%\includegraphics[width=\textwidth]{img/screenshots/bucket_browser.png}
		\end{columns}
	\end{frame}
	
	\begin{frame}
		\frametitle{Keeping It Secure}
		\begin{itemize}
			\item Minimal scopes and group-based permissions.
			\item Presigned links limited in time and scope.
			\item Secrets managed by Kubernetes; TLS from the internal CA.
		\end{itemize}
	\end{frame}
	
	\begin{frame}
		\frametitle{The Payoff}
		\begin{itemize}
			\item Data moves smoothly from the lab to ORFEO.
			\item Files are stored in a standard (NeXus/NXem) from the start.
			\item Researchers get a simple workflow, and data remains FAIR for the future.
		\end{itemize}
	\end{frame}
	
	\begin{frame}
		\centering
		\Large Questions?
	\end{frame}
	
\end{document}
